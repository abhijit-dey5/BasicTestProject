Import-Module WebAdministration
$Websites = Get-ChildItem IIS:\Sites

foreach ($Site in $Websites) {

    $Binding = $Site.bindings
    [string]$BindingInfo = $Binding.Collection
    [int] $len = $BindingInfo.Length
    [string]$IP = $BindingInfo.SubString($BindingInfo.IndexOf(" "),$BindingInfo.IndexOf(":")-$BindingInfo.IndexOf(" "))         
    [string]$Port = $BindingInfo.SubString($BindingInfo.IndexOf(":")+1,$BindingInfo.LastIndexOf(":")-$BindingInfo.IndexOf(":")-1) 

    if($enabled_protocol -eq "https"){
    [String] $Hostname = $BindingInfo.Substring($BindingInfo.LastIndexOf(":")+1, $BindingInfo.LastIndexOf(" ") -$BindingInfo.LastIndexOf(":")-1)
    }

    else{
    [String] $Hostname = $BindingInfo.Substring($BindingInfo.LastIndexOf(":")+1, $len -$BindingInfo.LastIndexOf(":")-1)
    }




    Write-Host "Binding info for" $Site.name " - IP:"$IP", Port:"$Port ", Hostname: " $Hostname

    if($Port -eq "<%= @http_port_number %>" -or $port -eq "<%=@https_port_number%>"){
     Stop-Website $Site.name
     }

   
    
}
